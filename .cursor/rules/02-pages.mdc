---
description: Padroes de paginas - list, detail, create
globs: ["src/pages/**"]
alwaysApply: false
---

# Pages - Padroes CORRETOS

## Estrutura de List Page

```tsx
export function XListPage() {
  // 1. Hooks: navigate, queryClient, state (filters, pagination, modals, tabs)
  // 2. useQuery para dados ativos + useQuery para lixeira (com paginacao)
  // 3. Mutations: save, delete (com onError 409), restore
  // 4. Handlers (openCreate, openEdit, closeModal)
  // 5. Definicao de columns (active + trash)
  // 6. Return: PageContainer > Tabs > Filters > Table > Pagination > Modals
}
```

## Padrao de Tabs (Ativas + Lixeira)

```tsx
const tabs = [
  { key: 'active', label: 'Ativas' },
  { key: 'TRASH', label: 'Lixeira' },
]
const [activeTab, setActiveTab] = useState('active')
const isTrash = activeTab === 'TRASH'
```

## Padrao de Queries

```tsx
// Lista ativa (sem paginacao ou com filtro)
const { data, isLoading } = useQuery({
  queryKey: ['resource', filter],
  queryFn: () => listResource(filter || undefined),
  enabled: !isTrash,
})

// Lixeira (com paginacao)
const { data: deletedResponse } = useQuery({
  queryKey: ['resource', 'deleted', page],
  queryFn: () => listDeletedResource({ page, limit: PAGE_LIMIT }),
  enabled: isTrash,
})
const deletedItems = deletedResponse?.data ?? []
const pagination = deletedResponse?.pagination
```

## Padrao de Mutations

```tsx
// Delete com tratamento de 409
const deleteMutation = useMutation({
  mutationFn: () => deleteResource(target!.id),
  onSuccess: () => {
    toast.success('Recurso desativado!')
    queryClient.invalidateQueries({ queryKey: ['resource'] })
    setTarget(null)
  },
  onError: (error: unknown) => {
    const axiosError = error as { response?: { status?: number; data?: { details?: DeactivationErrorDetails } } }
    if (axiosError.response?.status === 409 && axiosError.response.data?.details) {
      setBlockedInfo({ name: target!.name, id: target!.id, details: axiosError.response.data.details })
    }
    setTarget(null)
  },
})

// Restore
const restoreMutation = useMutation({
  mutationFn: () => restoreResource(restoreTarget!.id),
  onSuccess: () => {
    toast.success('Recurso restaurado!')
    queryClient.invalidateQueries({ queryKey: ['resource'] })
    setRestoreTarget(null)
  },
})
```

## Modals obrigatorios

- `Modal` (de `@/components/ui/Modal`) para create/edit
- `ConfirmModal` (exportado do mesmo `Modal.tsx`) para delete e restore
- `DeactivationBlockedModal` para quando o delete retorna 409

## Tipos de paginas

- `XListPage` (lista com tabs Ativas/Lixeira): users, schools, courses, seasons, classes, projectTemplates, studyTrackCategories, dailyMissionTemplates
- `XDetailPage` (detalhe/sub-entidades): ClassDetailPage, ProjectTemplateDetailPage
- `XCreatePage` (criacao): UserCreatePage
- **Outras**: DashboardPage, SettingsPage, StoragePage, ProjectInstancesPage
- Arquivo = nome do componente: `UsersListPage.tsx`

## Data Fetching

- `useQuery({ queryKey, queryFn })` para leitura
- `useMutation({ mutationFn, onSuccess, onError? })` para escrita
- SEMPRE `queryClient.invalidateQueries()` apos mutacao
- NUNCA importar `prisma` ou acessar DB (isso eh backend)

## ANTI-PATTERNS

- NAO usar `useEffect` para fetch (usar useQuery)
- NAO usar `error: any` em handlers (usar `error: unknown` com type assertion)
- NAO omitir restoreMutation quando a page tem tab de lixeira
- NAO esquecer tratamento de 409 no deleteMutation
- NAO omitir estado de loading na Table (passar `isLoading`)
